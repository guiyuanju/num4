name: Build Windows x86 Application

on:
  push:
    branches: [ main, master ]
    tags:
      - 'v*'
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        architecture: 'x86'
    
    - name: Compile Java application
      run: |
        javac -encoding UTF-8 NumberGroupGenerator.java
    
    - name: Create JAR with manifest
      run: |
        echo "Main-Class: NumberGroupGenerator" > manifest.txt
        jar cvfm NumberGroupGenerator.jar manifest.txt NumberGroupGenerator*.class
    
    # - name: Create Windows installer with jpackage
    #   run: |
    #     jpackage `
    #       --input . `
    #       --name "NumberGroupGenerator" `
    #       --main-jar NumberGroupGenerator.jar `
    #       --main-class NumberGroupGenerator `
    #       --type msi `
    #       --win-console `
    #       --app-version "1.0.0" `
    #       --vendor "Your Name" `
    #       --description "Number Group Generator Application" `
    #       --dest dist
    
    - name: Create portable app (no installation required)
      run: |
        jpackage `
          --input . `
          --name "NumberGroupGenerator" `
          --main-jar NumberGroupGenerator.jar `
          --main-class NumberGroupGenerator `
          --type app-image `
          --win-console `
          --app-version "1.0.0" `
          --vendor "Your Name" `
          --description "Number Group Generator Application" `
          --dest portable
    
    - name: Create portable app zip
      run: |
        Compress-Archive -Path portable\NumberGroupGenerator -DestinationPath NumberGroupGenerator-Portable-x86.zip
    
    # - name: Upload Windows installer
    #   uses: actions/upload-artifact@v4
    #   with:
    #     name: windows-x86-installer
    #     path: dist/*.msi
    #     if-no-files-found: error
    
    - name: Upload portable app
      uses: actions/upload-artifact@v4
      with:
        name: windows-x86-portable
        path: NumberGroupGenerator-Portable-x86.zip
    
    - name: Upload JAR file
      uses: actions/upload-artifact@v4
      with:
        name: jar-file
        path: NumberGroupGenerator.jar
    
    - name: Create Release
      if: startsWith(github.ref, 'refs/tags/')
      uses: softprops/action-gh-release@v1
      with:
        files: |
          # dist/*.msi
          NumberGroupGenerator-Portable-x86.zip
          NumberGroupGenerator.jar
        generate_release_notes: true
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
